require('dotenv').config();
const axios = require('axios');

const getGoogleOAuthToken = async (code) => {
  const url = 'https://oauth2.googleapis.com/token';
  const value = {
    code,
    client_id: process.env.google_oauth_client_id,
    client_secret: process.env.google_oauth_client_secret,
    redirect_uri: process.env.google_oauth_redirect_uri,
    grant_type: 'authorization_code'
  };
  try {
    const response = await axios.post(url + '?' + new URLSearchParams(value), {
      header: {
        'Content-Type': 'application/x-www-form-urlencoded'
      }
    });
    return response.data;
  } catch (error) {
    console.error(error, 'Error fetching google oauth token');
    throw new Error(error.message);
  }
};

const getGoogleUser = async (id_token, access_token) => {
  try {
    const response = await axios.get(`https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=${access_token}`, {
      header: {
        Authorization: `Bearer ${id_token}`
      }
    });
    return response.data;
  } catch (error) {
    console.error(error, 'Error fetching google user');
    throw new Error(error.message);
  }
};

module.exports = {
  getGoogleOAuthToken,
  getGoogleUser
};
